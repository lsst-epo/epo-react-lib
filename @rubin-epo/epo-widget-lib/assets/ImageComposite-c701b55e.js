import{s as V,j as $}from"./styled-components.browser.esm-e0114bd2.js";import{r as R}from"./index-8db94870.js";import{i as z,e as H}from"./utils-a2998f7e.js";import{g as U}from"./_commonjsHelpers-042e6b4d.js";import{_ as B}from"./_baseIsEqual-8f245713.js";import{C as X}from"./CircularLoader-50e78b89.js";var Y=B;function G(t,e){return Y(t,e)}var J=G;const K=U(J);function Q(t){const e=R.useRef();return R.useEffect(()=>{e.current=t},[t]),e.current}var P=new Map,Z=()=>"filter"in CanvasRenderingContext2D.prototype,S=t=>{let e=document.createElement("canvas");return e.height=t.canvas.height,e.width=t.canvas.width,Object.defineProperty(e,"__skipFilterPatch",{value:!0}),e.getContext("2d")};function ee(t,e){Object.defineProperty(t.prototype,"__skipFilterPatch",{writable:!0,value:!1}),Object.defineProperty(t.prototype,"__currentPathMirror",{writable:!0,value:void 0}),Object.defineProperty(e.prototype,"filter",{writable:!0,value:"none"})}var L=["__skipFilterPatch","__currentPathMirror","canvas","clearRect","filter","getImageData","globalCompositeOperation"];function te(t){Object.keys(t.prototype).filter(e=>L.indexOf(e)<0).map(e=>({member:e,descriptor:Object.getOwnPropertyDescriptor(t.prototype,e)})).filter(({descriptor:e})=>e.set).forEach(({member:e,descriptor:i})=>{let o=i;Object.defineProperty(t.prototype,e,{get:function(){return this.canvas.__skipFilterPatch?o.get.call(this):this.canvas.__currentPathMirror[e]},set:function(n){if(this.canvas.__skipFilterPatch)return o.set.call(this,n);this.canvas.__currentPathMirror||(this.canvas.__currentPathMirror=S(this)),this.canvas.__currentPathMirror[e]=n}})})}var ae=["clearRect","drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],re=(t,e)=>{var i;(i=e.match(/([-a-z]+)(?:\(([\w\d\s\.%-]*)\))?/gim))==null||i.map(o=>{var n;return(n=o.match(/([-a-z]+)(?:\((.*)\))?/i))==null?void 0:n.slice(1,3)}).reduce((o,[n,a])=>P.has(n)?P.get(n)(o,...(a||"").split(" ")):o,t)},T=t=>{let e=parseFloat(t);return/%\s*?$/i.test(t)&&(e/=100),e},se=t=>{let e=parseFloat(t);switch(t.slice(e.toString().length)){case"deg":e/=360;break;case"grad":e/=400;break;case"rad":e/=2*Math.PI;break}return e},q=t=>parseFloat(t);function ne(t){Object.keys(t.prototype).filter(e=>L.indexOf(e)<0).map(e=>({member:e,descriptor:Object.getOwnPropertyDescriptor(t.prototype,e)})).filter(({descriptor:e})=>e.value&&typeof e.value=="function").forEach(({member:e,descriptor:i})=>{let o=i.value;Object.defineProperty(t.prototype,e,{value:function(...n){if(this.canvas.__skipFilterPatch)return o.call(this,...n);this.canvas.__currentPathMirror||(this.canvas.__currentPathMirror=S(this));let a=this.canvas.__currentPathMirror[e](...n);if(ae.includes(e)){re(this.canvas.__currentPathMirror,this.filter),this.canvas.__skipFilterPatch=!0;let s;"getTransform"in this&&(s=this.getTransform(),this.setTransform(1,0,0,1,0,0)),this.drawImage(this.canvas.__currentPathMirror.canvas,0,0),s&&this.setTransform(s),this.canvas.__skipFilterPatch=!1,this.canvas.__currentPathMirror=S(this)}return a}})})}var ie=t=>t,oe=(t,e="0")=>{let i=q(e);if(i<=0)return t;let{height:o,width:n}=t.canvas,a=t.getImageData(0,0,n,o),{data:s}=a,r=n-1,d=o-1,c=i+1,u=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1][i],g=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18][i],h=[],l=[],p=[],m=[],I=[],b=[],x=3,f,v,w,k;for(;x-- >0;){let O=0,y=0;for(let C=0;C<o;C++){let D=s[O]*c,F=s[O+1]*c,j=s[O+2]*c,E=s[O+3]*c;for(let _=1;_<=i;_++)f=O+((_>r?r:_)<<2),D+=s[f++],F+=s[f++],j+=s[f++],E+=s[f];for(let _=0;_<n;_++)h[y]=D,l[y]=F,p[y]=j,m[y]=E,C===0&&(I[_]=((f=_+c)<r?f:r)<<2,b[_]=(f=_-i)>0?f<<2:0),v=O+I[_],w=O+b[_],D+=s[v++]-s[w++],F+=s[v++]-s[w++],j+=s[v++]-s[w++],E+=s[v]-s[w],y++;O+=n<<2}for(let C=0;C<n;C++){let D=C,F=h[D]*c,j=l[D]*c,E=p[D]*c,_=m[D]*c;for(let M=1;M<=i;M++)D+=M>d?0:n,F+=h[D],j+=l[D],E+=p[D],_+=m[D];y=C<<2;for(let M=0;M<o;M++)s[y+3]=k=_*u>>>g,k>0?(k=255/k,s[y]=(F*u>>>g)*k,s[y+1]=(j*u>>>g)*k,s[y+2]=(E*u>>>g)*k):s[y]=s[y+1]=s[y+2]=0,C===0&&(I[M]=((f=M+c)<d?f:d)*n,b[M]=(f=M-i)>0?f*n:0),v=C+I[M],w=C+b[M],F+=h[v]-h[w],j+=l[v]-l[w],E+=p[v]-p[w],_+=m[v]-m[w],y+=n<<2}}return t.putImageData(a,0,0),t},le=(t,e="1")=>{if(e=T(e),e===1)return t;e<0&&(e=0);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=0;r<s;r+=4)a[r+0]*=e,a[r+1]*=e,a[r+2]*=e;return t.putImageData(n,0,0),t},ce=(t,e="1")=>{if(e=T(e),e===1)return t;e<0&&(e=0);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=0;r<s;r+=4)a[r+0]=((a[r+0]/255-.5)*e+.5)*255,a[r+1]=((a[r+1]/255-.5)*e+.5)*255,a[r+2]=((a[r+2]/255-.5)*e+.5)*255;return t.putImageData(n,0,0),t},ue=(t,e,i,o,n)=>{let a=document.createElement("canvas").getContext("2d"),{width:s,height:r}=t.canvas;return a.canvas.width=s,a.canvas.height=r,a.shadowOffsetX=q(e),a.shadowOffsetY=q(i),a.shadowBlur=n?q(o||"0"):0,a.shadowColor=n||o||"transparent",a.drawImage(t.canvas,0,0),t.putImageData(a.getImageData(0,0,s,r),0,0),t},pe=(t,e="0")=>{if(e=T(e),e<=0)return t;e>1&&(e=1);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=0;r<s;r+=4){let d=a[r]*.2126+a[r+1]*.7152+a[r+2]*.0722;a[r+0]+=(d-a[r+0])*e,a[r+1]+=(d-a[r+1])*e,a[r+2]+=(d-a[r+2])*e}return t.putImageData(n,0,0),t},de=(t,e="0deg")=>{let i=se(e);if(i<=0)return t;let{height:o,width:n}=t.canvas,a=t.getImageData(0,0,n,o),{data:s}=a,r=(i%1+1)%1*3,d=Math.floor(r),c=r-d,u=1-c,g,h,l,p,m,I,b,x,f;switch(d){default:g=h=l=p=m=I=b=x=f=0;break;case 0:g=u,h=0,l=c,p=c,m=u,I=0,b=0,x=c,f=u;break;case 1:g=0,h=c,l=u,p=u,m=0,I=c,b=c,x=u,f=0;break;case 2:g=c,h=u,l=0,p=0,m=c,I=u,b=u,x=0,f=c;break}let v=0;for(let w=0;w<o;++w)for(let k=0;k<n;++k){v=4*(w*n+k);let O=s[v+0],y=s[v+1],C=s[v+2];s[v+0]=Math.floor(g*O+h*y+l*C),s[v+1]=Math.floor(p*O+m*y+I*C),s[v+2]=Math.floor(b*O+x*y+f*C)}return t.putImageData(a,0,0),t},me=(t,e="0")=>{if(e=T(e),e<=0)return t;e>1&&(e=1);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=0;r<s;r+=4)a[r+0]=Math.abs(a[r+0]-255*e),a[r+1]=Math.abs(a[r+1]-255*e),a[r+2]=Math.abs(a[r+2]-255*e);return t.putImageData(n,0,0),t},ge=(t,e="1")=>{if(e=T(e),e<0)return t;e>1&&(e=1);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=3;r<s;r+=4)a[r]*=e;return t.putImageData(n,0,0),t},he=(t,e="1")=>{let i=T(e);if(i===1)return t;i<0&&(i=0);let{height:o,width:n}=t.canvas,a=t.getImageData(0,0,n,o),{data:s}=a,r=(1-i)*.3086,d=(1-i)*.6094,c=(1-i)*.082,u=n<<2;for(let g=0;g<o;g++){let h=g*u;for(let l=0;l<n;l++){let p=h+(l<<2),m=s[p+0],I=s[p+1],b=s[p+2];s[p+0]=(r+i)*m+d*I+c*b,s[p+1]=r*m+(d+i)*I+c*b,s[p+2]=r*m+d*I+(c+i)*b}}return t.putImageData(a,0,0),t},fe=(t,e="0")=>{if(e=T(e),e<=0)return t;e>1&&(e=1);let{height:i,width:o}=t.canvas,n=t.getImageData(0,0,o,i),{data:a}=n,{length:s}=a;for(let r=0;r<s;r+=4){let d=a[r+0],c=a[r+1],u=a[r+2];a[r+0]=(.393*d+.769*c+.189*u)*e+d*(1-e),a[r+1]=(.349*d+.686*c+.168*u)*e+c*(1-e),a[r+2]=(.272*d+.534*c+.131*u)*e+u*(1-e)}return t.putImageData(n,0,0),t};P.set("none",ie);P.set("blur",oe);P.set("brightness",le);P.set("contrast",ce);P.set("drop-shadow",ue);P.set("grayscale",pe);P.set("hue-rotate",de);P.set("invert",me);P.set("opacity",ge);P.set("saturate",he);P.set("sepia",fe);var ve=typeof HTMLCanvasElement<"u"&&typeof CanvasRenderingContext2D<"u";ve&&!Z()&&(ee(HTMLCanvasElement,CanvasRenderingContext2D),te(CanvasRenderingContext2D),ne(CanvasRenderingContext2D));const W=t=>{t.globalCompositeOperation="source-over"},ye=t=>Object.keys(t).reduce((e,i,o)=>t[i]!==void 0?e+=`${o>0?" ":""}${i}(${t[i]*100}%)`:"",""),_e=(t,e,i,o)=>{t.globalCompositeOperation="multiply";const n=z("color",e)?e:"transparent";t.fillStyle=n,t.fillRect(0,0,i,o),W(t)},Ie=(t,e=[],i,o)=>{t.globalCompositeOperation="screen",e.forEach(n=>{t.drawImage(n,0,0,i,o)}),W(t)},N=({images:t,filters:e})=>{const i=Q(t),[o,n]=R.useState(0),[a,s]=R.useState(),r=a==null?void 0:a.some(({complete:u})=>!u),d=o!==t.length&&r;return R.useLayoutEffect(()=>{K(i,t)||(n(0),s(t.map(({url:u,width:g,height:h})=>{const l=new Image(g,h);return l.crossOrigin="anonymous",l.onload=()=>{n(p=>p+1)},l.src=u,l})))},[t]),d?[[],!!d]:[[...a||[]].map((u,g)=>{if(!e[g].active)return;const h=document.createElement("canvas"),l=h.getContext("2d");if(l){const{width:p,height:m}=u,{color:I="transparent",brightness:b}=e[g];l.canvas.width=p,l.canvas.height=m,l.clearRect(0,0,p,m),l.filter=ye({brightness:b,contrast:1.3}),l.drawImage(u,0,0,p,m),_e(l,I,p,m)}return h}).filter(u=>!!u),!!d]},be=N;try{N.displayName="useFilteredImages",N.__docgenInfo={description:"",displayName:"useFilteredImages",props:{images:{defaultValue:null,description:"",name:"images",required:!0,type:{name:"ImageShape[]"}},filters:{defaultValue:null,description:"",name:"filters",required:!0,type:{name:"ImageFilter[]"}}}}}catch{}const Ce=V.div`
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  grid-area: image;
  background-color: rgba(0, 0, 0, var(--image-container-opacity, 0.1));
  transition: background-color ease var(--DURATION, 0.2s);
  width: 100%;
`,we=V.canvas`
  opacity: var(--loading-opacity, 0);
  transition: opacity ease var(--DURATION_SLOW, 0.4s);
  width: 100%;
`,De=V(X)`
  position: absolute;
`,A=R.forwardRef(({filters:t,width:e=600,height:i=600,selectedObjectName:o,className:n,children:a,isDisplayOnly:s,images:r},d)=>{var m;const[c,u]=R.useState(o),g=H(t);o!==c&&u(o);const[h,l]=be({images:r,filters:t}),p=(m=d==null?void 0:d.current)==null?void 0:m.getContext("2d");return p&&(p.clearRect(0,0,e,i),Ie(p,h,e,i)),$.jsxs(Ce,{style:{aspectRatio:`${e} / ${i}`,maxWidth:s?`${e}px`:void 0,"--image-container-opacity":!l&&g?1:.1},className:n,children:[l&&g&&$.jsx(De,{isVisible:l}),$.jsx(we,{style:{"--loading-opacity":l?0:1},ref:d,role:"img",hidden:l,width:e,height:i}),a]})});A.displayName="Widgets.ColorTool.ImageComposite";const je=A;try{Widgets.ColorTool.ImageComposite.displayName="Widgets.ColorTool.ImageComposite",Widgets.ColorTool.ImageComposite.__docgenInfo={description:"",displayName:"Widgets.ColorTool.ImageComposite",props:{filters:{defaultValue:null,description:"",name:"filters",required:!0,type:{name:"ImageFilter[]"}},images:{defaultValue:null,description:"",name:"images",required:!0,type:{name:"ImageShape[]"}},width:{defaultValue:{value:"600"},description:"",name:"width",required:!1,type:{name:"number"}},height:{defaultValue:{value:"600"},description:"",name:"height",required:!1,type:{name:"number"}},selectedObjectName:{defaultValue:null,description:"",name:"selectedObjectName",required:!0,type:{name:"string"}},isDisplayOnly:{defaultValue:null,description:"",name:"isDisplayOnly",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{je as I};
